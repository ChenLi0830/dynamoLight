service: local-dynamo
plugins:
  - serverless-dynamodb-local

custom:
  dynamodb:
    stages:
      - test
      - dev
    start:
      migrate: true
      seed: true

    seed:
      test:
        sources:
          - table: Clevo-Raw-Speech-Table
            rawsources: [./Clevo-Raw-Speech-Table.json]
          - table: Clevo-Categorized-Sentence-Table
            rawsources: [./Clevo-Categorized-Sentence-Table.json]
    #     - table: users
    #       rawsources: [./fake-test-users.json]

provider:
  name: aws
  runtime: nodejs10.x
  stage: dev

resources:
  Resources:
    ClevoRawSpeechTable:
      Type: "AWS::DynamoDB::Table"
      Properties:
        TableName: Clevo-Raw-Speech-Table
        AttributeDefinitions:
          - AttributeName: fileName
            AttributeType: S
        KeySchema:
          - AttributeName: fileName
            KeyType: HASH
        BillingMode: PAY_PER_REQUEST
    ClevoCategorizedSentenceTable:
      Type: "AWS::DynamoDB::Table"
      Properties:
        TableName: Clevo-Categorized-Sentence-Table
        AttributeDefinitions:
          - AttributeName: categoryName
            AttributeType: S
          - AttributeName: fileNameBeginTime
            AttributeType: S
        KeySchema:
          - AttributeName: categoryName
            KeyType: HASH
          - AttributeName: fileNameBeginTime
            KeyType: RANGE
        BillingMode: PAY_PER_REQUEST
    APIKeysTable:
      Type: "AWS::DynamoDB::Table"
      Properties:
        TableName: APIKeys
        AttributeDefinitions:
          - AttributeName: key
            AttributeType: S
          - AttributeName: userName
            AttributeType: S
        KeySchema:
          - AttributeName: key
            KeyType: HASH
        GlobalSecondaryIndexes:
          - IndexName: userName-index
            KeySchema:
              - AttributeName: userName
                KeyType: HASH
            Projection:
              ProjectionType: ALL
        BillingMode: PAY_PER_REQUEST
